<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaMu.GG Wordle • TikTok Live</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #1e1b4b 0%, #0f172a 50%, #1e293b 100%); color: #e2e8f0; min-height: 100vh; margin:0; }
        .watermark { position: fixed; bottom: 15px; right: 15px; background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 12px; font-size: 14px; color: #fbbf24; z-index: 999; }
    </style>
</head>
<body>
    <div class="watermark" v-if="room === 'public' || !room">mamu.gg</div>
    <div id="app">
        <div class="container" style="padding:20px; text-align:center;">
            <h1 style="font-size:3rem; background: linear-gradient(to right,#8b5cf6,#3b82f6); -webkit-background-clip: text; color: transparent;">
                MaMu.GG Wordle • {{ room || 'PUBLIC' }}
            </h1>
            <p v-if="room && room !== 'public'" style="color:#10b981; font-weight:bold; font-size:1.3rem;">
                Private Room Active – Score tak campur!
            </p>
            <p style="font-size:1.1rem; margin:20px 0;">
                Jalankan Tikfinity → teka dalam live → score masuk automatik
            </p>
            <button @click="addTestScore" style="padding:12px 24px; background:#8b5cf6; color:white; border:none; border-radius:12px; font-size:1rem; cursor:pointer;">
                Test Tambah Score ({{ room || 'public' }})
            </button>
            <h3 style="margin-top:30px; color:#fbbf24;">Leaderboard {{ room || 'Public' }}</h3>
            <ol style="background:rgba(255,255,255,0.1); padding:20px; border-radius:12px; max-width:500px; margin:20px auto;">
                <li v-for="(s, i) in leaderboard" :key="i" style="margin:10px 0; font-size:1.2rem;">
                    #{{ i+1 }} {{ s.nickname || 'Anon' }} → {{ s.points }} pts
                </li>
                <li v-if="leaderboard.length === 0">Belum ada score</li>
            </ol>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const ROOM = urlParams.get('room') || 'public';

        const supabase = Supabase.createClient(
            import.meta.env.VITE_SUPABASE_URL || 'https://ixqepwpsjgnzqthhxaqo.supabase.co',
            import.meta.env.VITE_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml4cWVwd3BzamduenF0aGh4YXFvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY2Nzc2MDAsImV4cCI6MjA1MjI1MzYwMH0.qs5r4Z9b9kN9x9tF8z8c8r7v8w8x8y8z8A8B8C8D8E'
        );

        createApp({
            data() { return { room: ROOM, leaderboard: [] } },
            async mounted() {
                await this.loadScores();
                setInterval(this.loadScores, 8000);
            },
            methods: {
                async loadScores() {
                    const { data } = await supabase
                        .from('wordle_scores')
                        .select('*')
                        .eq('room', this.room)
                        .order('points', { ascending: false });
                    this.leaderboard = data || [];
                },
                async addTestScore() {
                    const nick = prompt("Nama tester:", "Tester"+Date.now().toString().slice(-4));
                    if (nick) {
                        await supabase.from('wordle_scores').insert({
                            room: this.room,
                            uniqueId: 'test_'+Date.now(),
                            nickname: nick,
                            points: Math.floor(Math.random()*15)+1
                        });
                        await this.loadScores();
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
